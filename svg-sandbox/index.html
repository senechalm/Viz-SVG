<html>
<head>
  <style>
    .pentaho-visual-base {
      border: solid 1px #005da6;
    }
  </style>

  <script type="text/javascript" src="node_modules/RequireJS/require.js"></script>

  <script type="text/javascript" src="node_modules/@pentaho/viz-api/dev-bootstrap.js"></script>

  <script>
    // Needed only in a sandbox environment.
    require.config({
      paths: {
        "pentaho/visual/samples/bar": ".",
        "d3": "./node_modules/d3/build/d3"
      }
    });
  </script>

  <script>
   require([
      "pentaho/type/Context",
      "pentaho/data/Table",
      "json!./officeFloor.json"
    ], function(Context, Table, dataSpec) {
      // Setup up a VizAPI context.
      Context.createAsync({application: "viz-api-sandbox"})
          .then(function(context) {
            // Get the model and base view types
            return context.getDependencyAsync({
              BarModel: "pentaho/visual/samples/bar/modelOffice",
              BaseView: "pentaho/visual/base/view"
            });
          })
          .then(function(types) {
            // Create the visualization model.
            var modelSpec = {
              "data": new Table(dataSpec),
              "category": {attributes: ["svgElementID"]},
			  "measure": {attributes: ["value"]}
            };
            var model = new types.BarModel(modelSpec);
            // Create the visualization view
            var viewSpec = {
              width: 780,
			  height: 500,
              domContainer: document.getElementById("viz_div"),
              model: model
            };
            // These are responsibilities of the visualization container application:
            // 1. Mark the container with the model's CSS classes, for styling purposes.
            viewSpec.domContainer.className = model.$type.inheritedStyleClasses.join(" ");
            // 2. Set the DOM container dimensions.
            viewSpec.domContainer.style.width = viewSpec.width + "px";
            viewSpec.domContainer.style.height = viewSpec.height + "px";
            // Create the visualization view.
            return types.BaseView.createAsync(viewSpec);
          })
          .then(function(view) {
            // Handle the execute action.
            view.on("pentaho/visual/action/execute", {
              "do": function(action) {
                alert("Executed " + action.dataFilter.contentKey);
              }
            });
            // Handle the select action.
            view.on("pentaho/visual/action/select", {
              "finally": function(action) {
                document.getElementById("messages_div").innerText = "Selected: " + action.dataFilter.contentKey;
              }
            });
            // Render the visualization.
            return view.update();
          });
    });
  </script>
</head>

<body>
  <div id="viz_div"></div>
</body>
</html>